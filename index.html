<script>
  function getTelegramId() {
    const params = new URLSearchParams(window.location.search);
    return params.get('telegram_id') || 'unknown';
  }

  window.onload = function() {
    const telegramId = getTelegramId();

    const widget = new cp.CloudPayments();
    widget.charge({
        publicId: 'pk_a5cf89beefa44fbf0be6ea4da712b',
        description: '–û–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Telegram-–≥—Ä—É–ø–ø—É',
        amount: 100,
        currency: 'RUB',
        invoiceId: `tg_${telegramId}`,
        accountId: telegramId,
        skin: "mini",
        data: {
            telegram_id: telegramId
        }
    },
    function (options) {
        document.getElementById('loading-text').innerText = "–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ...";

        // üîÅ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—ã–¥–∞—á–∏ –¥–æ—Å—Ç—É–ø–∞
        fetch('https://yourdomain.com/send-links', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ telegram_id: telegramId })
        })
        .then(() => {
          document.getElementById('loading-text').innerText = "–°—Å—ã–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram!";
        })
        .catch(() => {
          document.getElementById('loading-text').innerText = "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–æ–∫.";
        });
    },
    function (reason, options) {
        alert("–û–ø–ª–∞—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.");
        document.getElementById('loading-text').innerText = "–û–ø–ª–∞—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
    });
  }
</script>
